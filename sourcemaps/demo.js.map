{"version":3,"sources":["demo.coffee"],"names":[],"mappings":"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","file":"demo.js","sourceRoot":"/source/","sourcesContent":["\n\n\n\n############################################################################################################\n# njs_util                  = require 'util'\n# njs_path                  = require 'path'\n# njs_fs                    = require 'fs'\n#...........................................................................................................\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'kwic'\nlog                       = CND.get_logger 'plain',     badge\ninfo                      = CND.get_logger 'info',      badge\nwhisper                   = CND.get_logger 'whisper',   badge\nalert                     = CND.get_logger 'alert',     badge\ndebug                     = CND.get_logger 'debug',     badge\nwarn                      = CND.get_logger 'warn',      badge\nhelp                      = CND.get_logger 'help',      badge\nurge                      = CND.get_logger 'urge',      badge\necho                      = CND.echo.bind CND\n# suspend                   = require 'coffeenode-suspend'\n# step                      = suspend.step\n# after                     = suspend.after\n# eventually                = suspend.eventually\n# immediately               = suspend.immediately\n# every                     = suspend.every\nTEXT                      = require 'coffeenode-text'\nLODASH                    = CND.LODASH\n#...........................................................................................................\nKWIC                      = require './main'\nCODEC                     = require 'hollerith-codec'\n\n\ntext = \"\"\"a tram also known as tramcar and in north america known as streetcar trolley or trolley car\nis a rail vehicle which runs on tracks along public urban streets called street running and also\nsometimes on separate rights of way the lines or networks operated by tramcars are called tramways\ntramways powered by electricity which were the most common type historically were once called electric\nstreet railways however trams were widely used in urban areas before the universal adoption of\nelectrification and thus the other methods of powering trams is listed below under history\n\ntram lines may also run between cities and or towns for example interurbans tram train and or partially\ngrade separated even in the cities light rail very occasionally trams also carry freight tram vehicles\nare usually lighter and shorter than conventional trains and rapid transit trains but the size of trams\nparticularly light rail vehicles is rapidly increasing some trams for instance tram trains may also run\non ordinary railway tracks a tramway may be upgraded to a light rail or a rapid transit line two urban\ntramways may be connected to an interurban etc\n\nfor all these reasons the differences between the various modes of rail transportation are often\nindistinct\n\ntoday most trams use electrical power usually fed by an overhead pantograph in some cases by a sliding\nshoe on a third rail trolley pole or bow collector if necessary they may have dual power systems\nelectricity in city streets and diesel in more rural environments\n\nin the united states the term tram has sometimes been used for rubber tired trackless trains which are not\nrelated to the other vehicles covered in this article\na b c d e f g h i j k l m n o p q r s t u v w x y z\ncall\n\"\"\"\n\n# text = \"\"\"a e costarica america abcde acute ab ac ad\"\"\"\n# text = \"\"\"a b c ab ac ba bc ca cb abc acb cab cba bac bca cad\"\"\"\n\n# text = \"\"\"\n# all\n# call\n# called\n# usually\n# partially\n# partiallys\n# historically\n# xxxxxxxcally\n# xxxxxxxcallx\n# xxxxxxcallx\n# occasionally\n# along\n# also\n# \"\"\"\n\n#-----------------------------------------------------------------------------------------------------------\nexclude_long_words = ( words, max_length = Infinity ) ->\n  return words[ .. ] if max_length is Infinity\n  ### TAINT uses code units, not character count ###\n  return words.filter ( word ) => word.length <= max_length\n\n#-----------------------------------------------------------------------------------------------------------\nunique_words_from_text = ( text, max_length = Infinity ) ->\n  words = text.split /\\s+/\n  words = ( word for word in words when word.length > 0 )\n  words.sort()\n  words = LODASH.uniq words, true\n  return exclude_long_words words, max_length\n\n#-----------------------------------------------------------------------------------------------------------\n# factors_from_word = ( word ) -> TEXT.split word\n\n#-----------------------------------------------------------------------------------------------------------\nfactorize = ( entries, factorizer = null ) ->\n  factorizer ?= TEXT.split.bind TEXT\n  return ( [ ( factorizer entry ), entry, ] for entry in entries )\n\n#-----------------------------------------------------------------------------------------------------------\nfind_longest_word = ( words ) ->\n  R = -Infinity\n  R = Math.max R, chrs.length for [ _, chrs, ] in words\n  return R\n\n#-----------------------------------------------------------------------------------------------------------\n_reverse = ( text ) -> ( TEXT.split text ).reverse().join ''\n\n#-----------------------------------------------------------------------------------------------------------\nadd_lineups = ( factors_and_entries, max_lc, width ) ->\n  # padding_width       = max_lc - 1\n  padding_width       = ( width - 1 ) / 2\n  right_padding_width = width               + padding_width\n  left_padding_width  = right_padding_width + padding_width\n  help 'padding_width:       ', padding_width\n  help 'right_padding_width: ', right_padding_width\n  help 'left_padding_width:  ', left_padding_width\n  #.........................................................................................................\n  for [ factors, word, ], word_idx in factors_and_entries\n    last_idx = factors.length - 1 + padding_width\n    factors.push     ' ' while factors.length < right_padding_width\n    factors.unshift  ' ' while factors.length <  left_padding_width\n    permutations = []\n    for idx in [ padding_width .. last_idx ]\n      infix     = factors[ idx ]\n      suffix    = factors[ idx + 1 .. idx + padding_width ].join ''\n      prefix_A  = factors[ idx - padding_width .. idx - 1 ].join ''\n      ### TAINT to be replaced by principled implementation ###\n      prefix_B  = _reverse prefix_A\n      # permutations.push [ infix, prefix_B, suffix, prefix_A, ].join ','\n      permutations.push [ infix, suffix, prefix_B, prefix_A, ].join ','\n    factors_and_entries[ word_idx ][ 1 ] = permutations\n  #.........................................................................................................\n  return factors_and_entries\n\n#-----------------------------------------------------------------------------------------------------------\npermute = ( words ) ->\n  R = []\n  #.........................................................................................................\n  for [ word, lineups, ] in words\n    for lineup in lineups\n      R.push [ lineup, word, ]\n  #.........................................................................................................\n  R.sort ( a, b ) ->\n    return +1 if a[ 0 ] > b[ 0 ]\n    return -1 if a[ 0 ] < b[ 0 ]\n    return  0\n  #.........................................................................................................\n  return R\n\n#-----------------------------------------------------------------------------------------------------------\nreport = ( permutations ) ->\n  for [ lineup, word, ] in permutations\n    # [ infix, prefix_B, suffix, prefix_A, ]  = lineup.split ','\n    # lineup                                  = prefix_A + '' + infix + '|' + suffix\n    [ infix, suffix, prefix_B, prefix_A, ]  = lineup.split ','\n    lineup                                  = prefix_A + '|' + infix + '' + suffix\n    help lineup, ' ', word\n  return null\n\n###\nresolve_letters words\n# words         = exclude_long_words words\n###\n\n\n############################################################################################################\nunless module.parent?\n  kwic    = KWIC.new_kwic()\n  entries = unique_words_from_text text\n  KWIC.add kwic, entry for entry in entries\n  alphabet = [\n    'a', 'b', 'c', 'd',\n    'e', 'f', 'g', 'h',\n    'i', 'j', 'k', 'l', 'm', 'n',\n    'o', 'p', 'q', 'r', 's', 't',\n    'u', 'v', 'w', 'x', 'y', 'z',\n    ]\n  KWIC.factorize kwic\n  KWIC.add_weights kwic\n  KWIC.permute kwic\n  KWIC.sort kwic\n\n  for [ key, weight_idx, weights, lineup, entry, ] in kwic[ 'facets' ]\n    [ prefix, infix, suffix, ] = lineup\n    prefix.unshift ' ' until prefix.length >= 10\n    suffix.push    ' ' until suffix.length >= 10\n    prefix    = prefix.join ''\n    suffix    = suffix.join ''\n    weights   = weights.join '-'\n    help prefix + '|' + infix + suffix, entry, weights\n\n  # factors_and_entries = factorize entries\n  # max_lc              = find_longest_word factors_and_entries\n  # width               = 2 * ( max_lc - 1 ) + 1\n  # entries_and_lineups = add_lineups factors_and_entries, max_lc, width\n  # permutations        = permute entries_and_lineups\n  # report permutations\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"]}
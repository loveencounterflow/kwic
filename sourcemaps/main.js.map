{"version":3,"sources":["main.coffee"],"names":[],"mappings":"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","file":"main.js","sourceRoot":"/source/","sourcesContent":["\n\n\n\n############################################################################################################\n# njs_util                  = require 'util'\n# njs_path                  = require 'path'\n# njs_fs                    = require 'fs'\n#...........................................................................................................\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'KWIC'\n# log                       = CND.get_logger 'plain',     badge\n# info                      = CND.get_logger 'info',      badge\n# whisper                   = CND.get_logger 'whisper',   badge\n# alert                     = CND.get_logger 'alert',     badge\n# debug                     = CND.get_logger 'debug',     badge\n# warn                      = CND.get_logger 'warn',      badge\nhelp                      = CND.get_logger 'help',      badge\n# urge                      = CND.get_logger 'urge',      badge\necho                      = CND.echo.bind CND\nTEXT                      = require 'coffeenode-text'\nCODEC                     = require 'hollerith-codec'\n\n\n#-----------------------------------------------------------------------------------------------------------\n@get_factors = ( entry, factorizer = null ) ->\n  factorizer ?= @_get_factorizer factorizer\n  return factorizer entry\n\n#-----------------------------------------------------------------------------------------------------------\n@_get_factorizer = ( factorizer = 'characters' ) ->\n  switch type = CND.type_of factorizer\n    when 'function'\n      R = factorizer\n    when 'text'\n      R = @factorizers[ factorizer ]\n      throw new Error \"unknown factorizer name #{rpr factorizer}\" unless R?\n    else\n      throw new Error \"illegal factorizer type #{rpr type}\"\n  return R\n\n#-----------------------------------------------------------------------------------------------------------\n@get_weights = ( factors, alphabet = 'unicode' ) ->\n  weighter  = @_get_weighter alphabet\n  R         = []\n  for factor in factors\n    R.push weight = weighter factor\n    throw new Error \"factor not in alphabet: #{rpr factor}\" if weight is undefined\n  return R\n\n#-----------------------------------------------------------------------------------------------------------\n@_get_weighter = ( alphabet = 'unicode' ) ->\n  switch type = CND.type_of alphabet\n    #.......................................................................................................\n    when 'function'\n      R = alphabet\n    #.......................................................................................................\n    when 'text'\n      R = @alphabets[ alphabet ]\n      throw new Error \"unknown alphabet name #{rpr alphabet}\" unless R?\n    #.......................................................................................................\n    when 'list'\n      alphabet_pod = {}\n      do -> alphabet_pod[ factor ] = idx for factor, idx in alphabet\n      R = ( factor ) -> alphabet[ factor ]\n    #.......................................................................................................\n    else\n      throw new Error \"illegal alphabet type #{rpr type}\"\n  #.........................................................................................................\n  return R\n\n#-----------------------------------------------------------------------------------------------------------\n@get_permutations = ( factors, weights ) ->\n  R = []\n  #.........................................................................................................\n  weights           = weights[ .. ]\n  permutation_count = weights.length\n  weights.push -Infinity\n  for infix_idx in [ 0 ... permutation_count ]\n    prefix    = factors[ ... infix_idx ]\n    infix     = factors[ infix_idx ]\n    suffix    = factors[ infix_idx + 1 .. ]\n    ### Here we reverse the order of weights in the 'suffix' part of the weights (the part that comes\n    behind the guard value); this means that both prefix and suffix weights that are closer to the\n    infix have a stronger influence on the sorting than those that are further away. ###\n    r_idx     = permutation_count - infix_idx\n    r_weights = weights[ .. r_idx ].concat weights[ r_idx + 1 .. ].reverse()\n    R.push [ r_weights, infix, suffix, prefix, ]\n    #.....................................................................................................\n    # weights   = weights[ .. ]\n    @_rotate_left weights\n  #.........................................................................................................\n  return R\n\n#-----------------------------------------------------------------------------------------------------------\n@permute = ( entry, settings ) ->\n  factorizer  = settings?[ 'factorizer' ] ? null\n  alphabet    = settings?[ 'alphabet'   ] ? null\n  factors     = @get_factors   entry,   factorizer\n  weights     = @get_weights   factors, alphabet\n  return @get_permutations factors, weights\n\n#-----------------------------------------------------------------------------------------------------------\n@sort = ( collection ) ->\n  facets = []\n  #.........................................................................................................\n  for [ permutations, entry, ] in collection\n    for key in permutations\n      bkey = CODEC.encode key\n      facets.push [ bkey, key, entry, ]\n  facets.sort ( a, b ) -> a[ 0 ].compare b[ 0 ]\n  #.........................................................................................................\n  return ( [ prefix, infix, suffix, entry, ] for [ _, [ _, infix, suffix, prefix, ], entry, ] in facets )\n\n#-----------------------------------------------------------------------------------------------------------\n@report = ( collection, settings ) ->\n  padder    = settings?[ 'padder'    ] ? ' '\n  separator = settings?[ 'separator' ] ? '|'\n  joiner    = settings?[ 'joiner'    ] ? ''\n  show      = if process.stdout.isTTY then help else echo\n  #.........................................................................................................\n  lineups_and_entries = @sort collection\n  #.........................................................................................................\n  max_length = -Infinity\n  for [ prefix, infix, suffix, entry, ] in lineups_and_entries\n    max_length = Math.max max_length, prefix.length\n  #.........................................................................................................\n  for [ prefix, infix, suffix, entry, ] in lineups_and_entries\n    prefix    = prefix[ ... ]\n    suffix    = suffix[ ... ]\n    prefix.unshift padder until prefix.length is max_length\n    suffix.push    padder until suffix.length is max_length\n    prefix    = prefix.join joiner\n    suffix    = suffix.join joiner\n    entry     = if CND.isa_text entry then entry else rpr entry\n    show prefix + separator + infix + suffix + padder + entry\n  #.........................................................................................................\n  return null\n\n\n#===========================================================================================================\n# FACTORIZERS AND ALPHABETS\n#-----------------------------------------------------------------------------------------------------------\n@factorizers = {\n  'characters':       TEXT.split.bind TEXT\n  }\n\n#-----------------------------------------------------------------------------------------------------------\n@alphabets = {\n  'unicode':          ( factor ) -> factor.codePointAt 0\n  }\n\n\n#===========================================================================================================\n# HELPERS\n#-----------------------------------------------------------------------------------------------------------\n@_rotate_left = ( list ) ->\n  return list if list.length < 2\n  list.push list.shift()\n  return list\n\n# #-----------------------------------------------------------------------------------------------------------\n# @_rotate_right = ( list ) ->\n#   return list if list.length < 2\n#   list.unshift list.pop()\n#   return list\n\n"]}